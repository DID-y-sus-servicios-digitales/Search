<html>
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FX0LELX31C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FX0LELX31C');
</script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>      <!-- El SDK principal de Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-analytics-compat.js"></script> <!-- El SDK de Analytics -->
    <!-- Script para inicializar Firebase y Analytics - ¡Añade este! -->
<script>
    const firebaseConfig = {
    apiKey: "AIzaSyAiq27-ue3MeC2H4i1nNKyfJNvWCfmScaw",
    authDomain: "didia5.firebaseapp.com",
    databaseURL: "https://didia5-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "didia5",
    storageBucket: "didia5.firebasestorage.app",
    messagingSenderId: "652405109295",
    appId: "1:652405109295:web:714467f3edb571c6a28cda",
    measurementId: "G-1SB0J1PPK9"
  };

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const analytics = firebase.Analytics(app);
  // Si necesitas enviar eventos personalizados, puedes usar la variable 'analytics', por ejemplo:
  // analytics.logEvent('user_login');
   analytics.logEvent('user_name')
</script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        .mensaje-usuario{
            color: #000;
        }
        .mensaje-modelo{
            background-image: linear-gradient(#f00, #f0f);
            color: #fff;
            border-radius: 20px;
        }
        input{
            border-radius: 20px;
            font-size: 50px;
            border: 4px solid #f0f;
        }
        button{
            font-size: 50px;
            background-color: #fff;
            border: 4px solid #f00;
            border-radius: 20px;
        }
        .boton-ia{
             border-radius:20px ;
             border:2px solid #ff00ff ;
             background-color: white;
            text-decoration: none;
        }
    </style>
    
<title>genDID AI: gemini api</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="icon" href="favicon-16x16.png" type="image/png">
</head>
<body>
    <a href="index.html" class="boton-ia">DID search</a>
<center>
<input placeholder="Cuál es el problema?" id="input-usuario"></input><button id="boton-enviar">Preguntar</button>
<h3 id="salida-chat"></h3>
</center>
<script type="module">
    // Importa la clase GoogleGenerativeAI desde el módulo de Google
import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";

// -------------------------------------------------------------------
//                  CONFIGURACIÓN INICIAL
// -------------------------------------------------------------------

// 1. REEMPLAZA "TU_API_KEY" con la clave que obtuviste de Google AI Studio.
const API_KEY = "AIzaSyC3yd3XV6LvlzJK4na6n8J3IRVj_SoWeJo";

// 2. CONECTA TUS ELEMENTOS HTML AQUÍ
// Asegúrate de que tu HTML tenga un <input id="input-usuario"> y un <div id="salida-chat">
const userInput = document.getElementById('input-usuario');
const chatOutput = document.getElementById('salida-chat');
const sendButton = document.getElementById('boton-enviar'); // Asume que tienes un botón con este id

// -------------------------------------------------------------------
//                  LÓGICA DEL CHAT CON GEMINI
// -------------------------------------------------------------------

// Inicializa el modelo de Gemini
const genAI = new GoogleGenerativeAI(API_KEY);
const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

// Mantiene el historial para que el chat tenga contexto
let conversationHistory = [];

/**
 * Función principal para enviar un mensaje a la API de Gemini.
 */
async function sendMessage() {
  const message = userInput.value.trim();
  if (!message) {
    return; // No hace nada si el mensaje está vacío
  }

  // Muestra el mensaje del usuario en el output
  analytics.logEvent("Mensaje enviado a Gemini");
  // Puedes darle el estilo que quieras en tu CSS
  chatOutput.innerHTML += `<div class="mensaje-usuario">${message}</div>`;

  // Limpia el input y deshabilita el botón mientras espera la respuesta
  userInput.value = '';
  sendButton.disabled = true;

  try {
    // Inicia el chat con el historial previo
    const chat = model.startChat({
      history: conversationHistory,
    });

    // Envía el mensaje y espera la respuesta
    const result = await chat.sendMessage(message);
    const response = await result.response;
    const modelMessage = response.text();

    // Muestra la respuesta del modelo en el output
    // Puedes darle el estilo que quieras en tu CSS
    chatOutput.innerHTML += `<div class="mensaje-modelo">${modelMessage}</div>`;

    // Actualiza el historial con el nuevo par de mensajes (usuario y modelo)
    conversationHistory.push({ role: "user", parts: [{ text: message }] });
    conversationHistory.push({ role: "model", parts: [{ text: modelMessage }] });

  } catch (error) {
    console.error("Error al enviar el mensaje:", error);
    chatOutput.innerHTML += `<div class="mensaje-error"><strong>Error:</strong> No se pudo obtener una respuesta.</div>`;
  } finally {
    // Reactiva el botón y pone el foco en el input
    sendButton.disabled = false;
    userInput.focus();
    // Hace scroll hacia el final del chat
    chatOutput.scrollTop = chatOutput.scrollHeight;
  }
}

// -------------------------------------------------------------------
//                  EVENT LISTENERS
// -------------------------------------------------------------------

// Escucha el clic en el botón de enviar
sendButton.addEventListener('click', sendMessage);

// Escucha la tecla "Enter" en el campo de texto
userInput.addEventListener('keypress', (event) => {
  if (event.key === 'Enter') {
    sendMessage();
  }
});

</script>
</body>
</html>
