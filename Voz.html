<!DOCTYPE html>
<html>
<head>
    <title>Fotofrafo inteligente</title>
    <style>
        #video-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px; /* Tamaño del cuadrado */
            height: 300px;
            overflow: hidden;
            border: 2px solid black;
        }

        #video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #texto-reconocido {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 5px;
        }

        #descargar-foto {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video" autoplay></video>
    </div>
    <button id="boton-foto">Tomar foto</button>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="foto" style="display:none;">
    <button id="descargar-foto" style="display: none;">Descargar foto</button>
    <div id="texto-reconocido"></div>

    <script>
        const video = document.getElementById('video');
        const botonFoto = document.getElementById('boton-foto');
        const canvas = document.getElementById('canvas');
        const foto = document.getElementById('foto');
        const contexto = canvas.getContext('2d');
        const textoReconocido = document.getElementById('texto-reconocido');
        const descargarFoto = document.getElementById('descargar-foto');
        let stream;
        let camaraTrasera = false;

        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            iniciarCamara();

            const reconocimiento = new webkitSpeechRecognition();
            reconocimiento.lang = 'es-ES';

            reconocimiento.onresult = evento => {
                const transcripcion = evento.results[0][0].transcript.toLowerCase();
                textoReconocido.textContent = transcripcion;
                if (transcripcion.includes('patata')) {
                    tomarFoto();
                } else if (transcripcion.includes('voltear')) {
                    camaraTrasera = !camaraTrasera;
                    iniciarCamara();
                }
            };

            reconocimiento.start();

            botonFoto.onclick = tomarFoto;
            descargarFoto.onclick = descargarImagen;
        } else {
            alert('La cámara no es compatible con este navegador.');
        }

        function iniciarCamara() {
            const constraints = {
                video: { facingMode: camaraTrasera ? 'environment' : 'user' }
            };

            navigator.mediaDevices.getUserMedia(constraints)
                .then(flujo => {
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                    stream = flujo;
                    video.srcObject = flujo;
                })
                .catch(error => {
                    console.error('Error al acceder a la cámara:', error);
                });
        }

        function tomarFoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            contexto.drawImage(video, 0, 0, canvas.width, canvas.height);
            const dataUrl = canvas.toDataURL('image/png');
            foto.src = dataUrl;
            foto.style.display = 'block';
            descargarFoto.style.display = 'block';
        }

        function descargarImagen() {
            const enlaceDescarga = document.createElement('a');
            enlaceDescarga.href = foto.src;
            enlaceDescarga.download = 'foto.png';
            enlaceDescarga.click();
        }
    </script>
</body>
</html>
